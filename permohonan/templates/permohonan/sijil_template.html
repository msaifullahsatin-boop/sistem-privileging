{% load static %}
<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>Sijil Privileging - {{ permohonan.nama_pemohon }}</title>
    <style>
        @page {
            size: A4;
            margin: 0;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', Times, serif;
            color: #000;
        }
        .page {
            width: 210mm;
            height: 297mm;
            position: relative;
            box-sizing: border-box;
            padding: 10mm;
        }
        .page.page-1 {
            page-break-after: always;
        }
        .border-frame {
            width: 190mm;
            height: 277mm;
            border: 10px double #000;
            padding: 15mm;
            box-sizing: border-box;
            position: relative;
            margin: auto;
            text-align: center;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.15;
            width: 60%;
            z-index: 1;
        }
        .content-wrapper {
            position: relative;
            z-index: 2;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .header .logo-hospital {
            height: 75px;
            width: auto;
        }
        .header .logo-jata {
            height: 90px;
            width: auto;
        }
        .header .placeholder {
            width: 75px; /* Match hospital logo width */
        }
        .title {
            font-size: 28pt;
            font-weight: bold;
            margin: 40px 0 20px 0;
            letter-spacing: 3px;
        }
        .subtitle {
            font-size: 14pt;
            margin: 30px 0;
        }
        .applicant-name {
            font-size: 24pt;
            font-weight: bold;
            text-transform: uppercase;
            margin: 20px 0;
        }
        .applicant-details {
            font-size: 14pt;
            line-height: 1.6;
        }
        .certificate-info {
            margin-top: 40px;
            font-size: 12pt;
            line-height: 1.8;
        }
        .signature-section {
            margin-top: auto; /* Pushes to the bottom */
            width: 300px;
            text-align: left;
        }
        .signature-section img {
            height: 60px;
            margin-bottom: 5px;
        }
        .signature-section .name {
            font-weight: bold;
            text-transform: uppercase;
        }
        /* Page 2 Styles */
        .page-2 .serial-top-right {
            position: absolute;
            top: 20mm;
            right: 20mm;
            font-size: 11pt;
            font-weight: bold;
        }
        .page-2 .procedures-list {
            margin-top: 30mm;
            font-size: 11pt;
        }
        .page-2 h3 {
            text-align: center;
            font-size: 16pt;
            margin-bottom: 20px;
        }
        .page-2 table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 10pt; /* Smaller font for table */
        }
        .page-2 th, .page-2 td {
            border: 1px solid #555;
            padding: 6px 8px;
            text-align: left;
        }
        .page-2 th {
            background-color: #e0e0e0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- PAGE 1 -->
    <div class="page page-1">
        <div class="border-frame">
            <img src="{% static 'permohonan/images/logo_hwkks.png' %}" class="watermark" alt="Watermark">
            <div class="content-wrapper">
                <div class="header">
                    <img src="{% static 'permohonan/images/logo_hwkks.png' %}" class="logo-hospital" alt="Logo Hospital">
                    <img src="{% static 'permohonan/images/jata_negara.png' %}" class="logo-jata" alt="Jata Negara">
                    <div class="placeholder"></div>
                </div>
                <div class="title">SIJIL PRIVILEGING</div>
                <div class="subtitle">Dengan ini disahkan bahawa</div>
                <div class="applicant-name">{{ permohonan.nama_pemohon }}</div>
                <div class="applicant-details">
                    No. KP: {{ permohonan.no_kp }}<br>
                    Jabatan: {{ permohonan.jabatan.nama }}
                </div>
                <div class="certificate-info">
                    Telah diberi kebenaran untuk menjalankan prosedur klinikal seperti yang disenaraikan.<br>
                    <strong>Nombor Siri:</strong> {{ permohonan.no_siri_sijil }}<br>
                    <strong>Sah Sehingga:</strong> {{ permohonan.tarikh_sah_sehingga|date:"d F Y" }}
                </div>
                <div class="signature-section">
                    <img src="{% static 'permohonan/images/tandatangan_pengarah.png' %}" alt="Tandatangan">
                    <div class="name">{{ permohonan.nama_pengarah|default:'(NAMA PENGARAH)' }}</div>
                    <div>{{ permohonan.jawatan_pengarah|default:'Pengarah Hospital' }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE 2 -->
    <div class="page page-2">
        <img src="{% static 'permohonan/images/logo_hwkks.png' %}" class="watermark" alt="Watermark">
        <div class="content-wrapper">
            <div class="serial-top-right">No. Siri: {{ permohonan.no_siri_sijil }}</div>
            <div class="procedures-list">
                <h3>SENARAI PROSEDUR YANG DILULUSKAN</h3>
                <p><strong>Nama:</strong> {{ permohonan.nama_pemohon }}</p>
                
                {% if permohonan.core_procedures.all %}
                    <h4>Core Procedures</h4>
                    <table>
                        <tr><th>Nama Prosedur</th></tr>
                        {% for item in permohonan.core_procedures.all %}
                            <tr><td>{{ item.prosedur.nama }}</td></tr>
                        {% endfor %}
                    </table>
                {% endif %}
                
                {% if permohonan.specialised_procedures.all %}
                    <h4 style="margin-top: 20px;">Specialised Procedures</h4>
                    <table>
                        <tr><th>Nama Prosedur</th></tr>
                        {% for item in permohonan.specialised_procedures.all %}
                            <tr><td>{{ item.prosedur.nama }}</td></tr>
                        {% endfor %}
                    </table>
                {% endif %}

                {% if permohonan.addition_procedures.all %}
                    <h4 style="margin-top: 20px;">Addition Procedures</h4>
                    <table>
                        <tr>
                            <th>Nama Prosedur</th>
                            <th style="width: 25%;">Jenis</th>
                        </tr>
                        {% for item in permohonan.addition_procedures.all %}
                            <tr>
                                <td>{{ item.prosedur.nama }}</td>
                                <td>{{ item.get_jenis_display }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>